<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Chi tiết bài viết</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .thumb-img { width: 100%; max-height: 300px; object-fit: cover; margin-bottom: 10px; }
  </style>
</head>
<body class="container py-5">
  <a href="index.html" class="btn btn-outline-primary mb-4">← Trang chủ</a>
  <div class="row">
    <div class="col-lg-8" id="postDetail"></div>
    <div class="col-lg-4">
      <h5>Bài viết khác</h5>
      <div id="suggestPosts" class="list-group small"></div>
    </div>
  </div>

  <script>
    const id = new URLSearchParams(location.search).get("id");
    const posts = JSON.parse(localStorage.getItem("posts")) || [];
    const post = posts.find(p => p.id == id);
    const detailDiv = document.getElementById("postDetail");

    if (post) {
  const imagesHTML = post.images.map(src => `<img src="${src}" class="img-fluid mb-3 rounded" style="max-height:300px; object-fit:cover;">`).join("");

  detailDiv.innerHTML = `
    ${imagesHTML}
    <h2>${post.title}</h2>
    <p class="text-muted">🕒 ${post.createdAt}</p>
    <p>${post.content.replace(/\n/g, "<br>")}</p>
    <div class="mt-4">
      <button class="btn btn-warning me-2" onclick="editPost(${post.id})">✏️ Sửa</button>
      <button class="btn btn-danger" onclick="deletePost(${post.id})">🗑️ Xóa</button>
    </div>
    <!-- Bình luận -->
<div class="mt-4">
  <h5>💬 Bình luận</h5>
  <div id="commentList" class="mb-3"></div>
  <textarea id="commentInput" class="form-control mb-2" placeholder="Viết bình luận..."></textarea>
  <button class="btn btn-sm btn-primary" onclick="addComment(${post.id})">Gửi bình luận</button>
</div>

<!-- Cảm xúc -->
<div class="mt-4">
  <h5>❤️ Cảm xúc</h5>
  <button class="btn btn-sm btn-outline-secondary me-1" onclick="react(${post.id}, 'like')">👍 Like (<span id="count-like">${post.reactions?.like || 0}</span>)</button>
  <button class="btn btn-sm btn-outline-danger me-1" onclick="react(${post.id}, 'love')">❤️ Love (<span id="count-love">${post.reactions?.love || 0}</span>)</button>
  <button class="btn btn-sm btn-outline-warning me-1" onclick="react(${post.id}, 'haha')">😆 Haha (<span id="count-haha">${post.reactions?.haha || 0}</span>)</button>
  <button class="btn btn-sm btn-outline-info me-1" onclick="react(${post.id}, 'sad')">😢 Sad (<span id="count-sad">${post.reactions?.sad || 0}</span>)</button>
  <button class="btn btn-sm btn-outline-dark" onclick="react(${post.id}, 'angry')">😠 Angry (<span id="count-angry">${post.reactions?.angry || 0}</span>)</button>
</div>

<!-- Chia sẻ -->
<div class="mt-4">
  <h5>🔗 Chia sẻ bài viết</h5>
  <div class="input-group">
    <input id="shareLink" type="text" class="form-control" value="${location.href}" readonly />
    <button class="btn btn-success" onclick="copyLink()">📋 Sao chép</button>
  </div>
</div>

  `;
}
 else {
      detailDiv.innerHTML = `<div class="alert alert-danger">Không tìm thấy bài viết!</div>`;
    }

    // Gợi ý bài viết
    const suggestions = posts.filter(p => p.id != id).slice(-5).reverse();
    const suggestList = document.getElementById("suggestPosts");
    suggestions.forEach(p => {
      const el = document.createElement("a");
      el.className = "list-group-item list-group-item-action";
      el.href = `view.html?id=${p.id}`;
      el.innerText = p.title;
      suggestList.appendChild(el);
    });

    // Xóa bài
    function deletePost(postId) {
      if (confirm("Bạn có chắc muốn xóa bài này?")) {
        const updated = posts.filter(p => p.id != postId);
        localStorage.setItem("posts", JSON.stringify(updated));
        alert("Đã xóa bài viết.");
        location.href = "index.html";
      }
    }

    // Sửa bài
    function editPost(postId) {
      localStorage.setItem("editingId", postId);
      location.href = "post.html";
    }
    function addComment(postId) {
  const text = document.getElementById("commentInput").value.trim();
  if (!text) return;

  const posts = JSON.parse(localStorage.getItem("posts")) || [];
  const index = posts.findIndex(p => p.id == postId);
  if (index !== -1) {
    const comment = {
      text,
      time: new Date().toLocaleString()
    };
    if (!posts[index].comments) posts[index].comments = [];
    posts[index].comments.push(comment);
    localStorage.setItem("posts", JSON.stringify(posts));
    renderComments(posts[index].comments);
    document.getElementById("commentInput").value = "";
  }
}

function renderComments(comments = []) {
  const list = document.getElementById("commentList");
  list.innerHTML = comments.map(c => `
    <div class="border rounded p-2 mb-1 bg-light">
      <div>${c.text}</div>
      <div class="text-muted small">🕒 ${c.time}</div>
    </div>
  `).join("");
}
function react(postId, type) {
  const posts = JSON.parse(localStorage.getItem("posts")) || [];
  const index = posts.findIndex(p => p.id == postId);
  if (index !== -1) {
    if (!posts[index].reactions) {
      posts[index].reactions = { like: 0, love: 0, haha: 0, sad: 0, angry: 0 };
    }
    posts[index].reactions[type]++;
    localStorage.setItem("posts", JSON.stringify(posts));
    document.getElementById("count-" + type).innerText = posts[index].reactions[type];
  }
}
function copyLink() {
  const input = document.getElementById("shareLink");
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  alert("📎 Đã sao chép liên kết!");
}

  </script>
</body>
</html>
